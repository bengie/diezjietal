<!DOCTYPE html>
<html itemtype="http://schema.org/Blog" itemscope class="no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Image Optimising with Gulp &#8211; Diezjietal</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Diezjietal is a freelance html and css architect and consultant">
	<meta name="author" content="Gregory Van Looy">
	<meta name="keywords" content="blog">
	<link rel="canonical" href="http://diezjietal.be/blog/2015/02/18/image-optimizers.html">

	<!-- Custom CSS -->
	<link rel="stylesheet" href="/css/main.css?201503031559" type="text/css">

	<!-- Fonts -->
	<link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
	<link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
	
	  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
	

	<script src="/js/vendors/modernizr.min.js"></script>

	<!-- Open Graph -->
	<meta property="og:locale" content="en_US">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Image Optimising with Gulp">
	<meta property="og:description" content="Diezjietal is a freelance html and css architect and consultant">
	<meta property="og:url" content="http://diezjietal.be/blog/2015/02/18/image-optimizers.html">
	<meta property="og:site_name" content="Diezjietal">
	
	<meta property="article:author" content="https://www.facebook.com/gregory.vanlooy">
	
	<meta property="article:section" content="blog">
	
	
	<meta property="article:published_time" content="2015-02-18 00:00:00 +0100">
	


	<!-- Icons -->
	<link rel="apple-touch-icon" sizes="57x57" href="apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="114x114" href="apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="72x72" href="apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="60x60" href="apple-touch-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="120x120" href="apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="76x76" href="apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180x180.png">
	<link rel="icon" type="image/png" href="favicon-192x192.png" sizes="192x192">
	<link rel="icon" type="image/png" href="favicon-160x160.png" sizes="160x160">
	<link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96">
	<link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16">
	<link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32">
</head>

<body>
	<section class="wrapper">
		<header class="page-header" role="banner">
	<div class="container">
		<nav class="nav primary-nav" role="navigation" itemtype="http://schema.org/SiteNavigationElement" itemscope>
	<ol class="nav__list">
		<li class="nav__item first">
			<a href="/" class="nav__link" itemscope itemtype="http://schema.org/Organization" itemprop="url">Diezjietal</a>
		</li>
		<li class="nav__item">
			<a href="/projects/" class="nav__link" itemprop="url">Projects</a>
		</li>
		<li class="nav__item">
			<a href="/blog/" class="nav__link" itemprop="url">Blog</a>
		</li>
		<li class="nav__item">
			<a href="/about/" class="nav__link" itemprop="url">About</a>
		</li>
		
	</ol>
</nav>

	</div>
</header>


		<div class="main-content" role="main">
			<div class="container">
				


<article class="article" role="article" itemtype="http://schema.org/BlogPosting" itemscope itemprop="blogPost">
	<header class="article__header">
		
		<h1 class="article__title" itemprop="headline">Image Optimising with Gulp</h1>
		<span class="article__meta" itemprop="datePublished">Feb 18, 2015</span>
		
		<span class="article__meta">
		
			5 minute read
		
		</span>
	</header>

	<div class="article__body" itemprop="articleBody">
		
			<p class="article__intro"></p>
		

		<p>We care about web performance but we <del>always</del> <em>often</em> forget to minimize our image assets. We can save upto 40% or more on those assets. This can be automated with certain apps or automated through a JS Task managers like <a href="http://gulpjs.com/">Gulp.js</a> or <a href="http://gruntjs.com/">Grunt.js</a></p>

<p>For this blogpost I use <strong>Gulp</strong></p>

<h2 id="pick-the-best-plugin">Pick the best plugin</h2>

<p>I found two candidates. <em>If I missed any, please place a comment below.</em></p>

<ul>
  <li><a href="https://www.npmjs.com/package/gulp-imagemin">gulp-imagemin</a></li>
  <li><a href="https://www.npmjs.com/package/gulp-smushit">gulp-smushit</a></li>
</ul>

<p>My testcase setup was as follows:</p>

<ul>
  <li>a folder with the original images ( 1 .jpg and 1 .png)</li>
  <li>separate destination folders for the optimised images</li>
</ul>

<p>Our test images … both resized and optimised for this blog post …</p>

<div class="row">
    <div class="col col--half">
        <figure>
            <img src="/img/salomon.jpg" alt="" />
            <figcaption>The JPG, 1928x1928 ~ 1.5 MB</figcaption>
        </figure>
    </div>
    <div class="col col--half omega">
        <figure>
            <img src="/img/shark9.png" alt="" />
            <figcaption>The PNG, 1082x610 ~ 85 KB</figcaption>
        </figure>
    </div>
</div>

<p>My <code>gulpfile.js</code> config</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">imagemin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-imagemin&#39;</span><span class="p">),</span>
    <span class="nx">smushit</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-smushit&#39;</span><span class="p">);</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;imagemin&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;img/*&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">imagemin</span><span class="p">({</span>
            <span class="nx">progressive</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}))</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;imagemin-img&#39;</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;smushit&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;img/*&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">smushit</span><span class="p">({</span>
            <span class="nx">verbose</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}))</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;smushit-img&#39;</span><span class="p">));</span>
<span class="p">});</span></code></pre></div>

<h3 id="gulp-imagemin">gulp-imagemin</h3>

<p>Minify PNG, JPEG, GIF and SVG images</p>

<p><strong>Pro:</strong></p>

<ul>
  <li>a lot of configurable options</li>
  <li>you can include other optimizing plugins, like <a href="https://www.npmjs.com/package/imagemin-pngquant">pngquant</a> <em>(see code example below)</em></li>
  <li>can handle all image formats</li>
</ul>

<p><strong>Cons:</strong></p>

<ul>
  <li>no <code>verbose</code> option for the output</li>
</ul>

<p><code>gulpfile.js</code> with <strong>pngquant</strong></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">imagemin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-imagemin&#39;</span><span class="p">),</span>
    <span class="nx">pngquant</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;imagemin-pngquant&#39;</span><span class="p">);</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;imagemin&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;img/*&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">imagemin</span><span class="p">({</span>
            <span class="nx">progressive</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">pngquant</span><span class="p">()]</span>
        <span class="p">}))</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;imagemin-img&#39;</span><span class="p">));</span>
<span class="p">});</span></code></pre></div>

<p>With <strong>pngquant enabled</strong> we save extra bytes on PNG files: 203.79 kB vs. 164.67 kB  (12.9% vs 10.4%) and you don’t notice any quality loss in the asset.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># with pngquant</span>
➜  optim  gulp imagemin
<span class="o">[</span>10:07:37<span class="o">]</span> Using gulpfile /Applications/MAMP/htdocs/POC/optim/gulpfile.js
<span class="o">[</span>10:07:37<span class="o">]</span> Starting <span class="s1">&#39;imagemin&#39;</span>...
<span class="o">[</span>10:07:38<span class="o">]</span> gulp-imagemin: Minified <span class="m">2</span> images <span class="o">(</span>saved 203.79 kB - 12.9%<span class="o">)</span>
<span class="o">[</span>10:07:38<span class="o">]</span> Finished <span class="s1">&#39;imagemin&#39;</span> after 1.07 s

<span class="c"># without pngquant</span>
➜  optim  gulp imagemin
<span class="o">[</span>11:10:05<span class="o">]</span> Using gulpfile /Applications/MAMP/htdocs/POC/optim/gulpfile.js
<span class="o">[</span>11:10:05<span class="o">]</span> Starting <span class="s1">&#39;imagemin&#39;</span>...
<span class="o">[</span>11:10:06<span class="o">]</span> gulp-imagemin: Minified <span class="m">2</span> images <span class="o">(</span>saved 164.67 kB - 10.4%<span class="o">)</span>
<span class="o">[</span>11:10:06<span class="o">]</span> Finished <span class="s1">&#39;imagemin&#39;</span> after <span class="m">835</span> ms</code></pre></div>

<h3 id="gulp-smushit">gulp-smushit</h3>

<p>Plugin to optimize PNG and JPG using Yahoo Smushit. <a href="http://smush.it/">Smush.it</a> uses optimization techniques specific to image format to remove unnecessary bytes from image files. It is a “lossless” tool, which means it optimizes the images without changing their look or visual quality.</p>

<p><strong>Pro:</strong></p>

<ul>
  <li>Easy to configure</li>
  <li>Plug ‘n’ play</li>
</ul>

<p><strong>Cons:</strong></p>

<ul>
  <li>Only for jpg and png</li>
</ul>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">smushit</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-smushit&#39;</span><span class="p">);</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;smushit&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;img/*&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">smushit</span><span class="p">({</span>
            <span class="nx">verbose</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}))</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;smushit-img&#39;</span><span class="p">));</span>
<span class="p">});</span></code></pre></div>

<p>Verbose output in the terminal</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">➜  optim  gulp smushit
<span class="o">[</span>10:37:47<span class="o">]</span> Using gulpfile /Applications/MAMP/htdocs/POC/optim/gulpfile.js
<span class="o">[</span>10:37:47<span class="o">]</span> Starting <span class="s1">&#39;smushit&#39;</span>...
<span class="o">[</span>10:37:51<span class="o">]</span> /Applications/MAMP/htdocs/POC/optim/img/salomon.jpg
<span class="o">[</span>10:37:51<span class="o">]</span> gulp-smushit: Compress rate % 8.60
<span class="o">[</span>10:37:51<span class="o">]</span> gulp-smushit: <span class="m">1491876</span> bytes  to   <span class="m">1363503</span> bytes
<span class="o">[</span>10:37:54<span class="o">]</span> /Applications/MAMP/htdocs/POC/optim/img/shark9.png
<span class="o">[</span>10:37:54<span class="o">]</span> gulp-smushit: Compress rate % 19.56
<span class="o">[</span>10:37:54<span class="o">]</span> gulp-smushit: <span class="m">84576</span> bytes  to   <span class="m">68034</span> bytes
<span class="o">[</span>10:37:54<span class="o">]</span> Finished <span class="s1">&#39;smushit&#39;</span> after 7.16 s</code></pre></div>

<h2 id="comparison">Comparison</h2>

<p>They both compress almost equally (see below) with <strong>imagemin</strong> coming in first place.</p>

<div class="row">
    <div class="col col--half">
        <figure>
            <img src="/img/salomon-imagemin.png" alt="" />
            <figcaption>jpg compressed with imagemin</figcaption>
        </figure>
    </div>
    <div class="col col--half omega">
        <figure>
            <img src="/img/salomon-smushit.png" alt="" />
            <figcaption>jpg compressed with smushit</figcaption>
        </figure>
    </div>
</div>

<div class="row">
    <div class="col col--half">
        <figure>
            <img src="/img/shark-imagemin.png" alt="" />
            <figcaption>png compressed with imagemin</figcaption>
        </figure>

        <figure>
            <img src="/img/shark9-imagemin-pngquant.png" alt="" />
            <figcaption>png compressed with imagemin and pngquant</figcaption>
        </figure>
    </div>
    <div class="col col--half omega">
        <figure>
            <img src="/img/shark-smushit.png" alt="" />
            <figcaption>png compressed with smushit</figcaption>
        </figure>
    </div>
</div>

<h3 id="crunching-the-numbers-">Crunching the numbers …</h3>

<table class="table table--bordered">
    <thead class="table__head">
        <th></th>
        <th scope="col">original</th>
        <th scope="col">Imagemin</th>
        <th scope="col">Smushit</th>
    </thead>
    <tbody class="table__body">
        <tr>
            <td scope="row">JPG</td>
            <td>1.491.876 bytes (1.5MB)</td>
            <td>1.344.231 bytes (1.3MB)</td>
            <td>1.363.503 bytes (1.4MB)</td>
        </tr>
        <tr>
            <td scope="row">PNG</td>
            <td>84.576 bytes (85KB)</td>
            <td>67.550 bytes (68kb)<br />
                <strong>28.428 bytes (28KB) with pngquant</strong></td>
            <td>68.034 bytes (68KB)</td>
        </tr>
        <tr>
            <td scope="row">Time</td>
            <td></td>
            <td>835ms or <strong>1.07s</strong></td>
            <td>7.16s</td>
        </tr>
    </tbody>
</table>

<p>And we have a winner: <a href="https://www.npmjs.com/package/gulp-imagemin">gulp-imagemin</a> !!!!</p>

<ul>
  <li>more options and extendable</li>
  <li>more image formats supported</li>
  <li>better compression</li>
  <li>faster</li>
</ul>

<h3 id="credits">Credits</h3>

<p>I originally wrote this Proof of Concept for the in-house teams of De Persgroep Publishing on the company’s intranet. Kudos to them for allowing me to share this blog post with the community.</p>


	</div>

	

</article>



	<div id="disqus_thread"></div>
	<script type="text/javascript">
		var disqus_shortname  = 'dzjtl';

		(function() {
			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




			</div>
		</div>
	</section>

	<footer class="page-footer" role="contentinfo">
	<div class="container">
		<small>&copy; diezjietal.be</small>
		
			<ul class="social-icons">
	
		<li class="social__item">
			<a class="social__link" href="https://github.com/bengie">
				<span class="fa fa-github"></span>
			</a>
		</li>
	
	
		<li class="social__item">
			<a class="social__link" href="/feed.xml">
				<span class="fa fa-rss"></span>
			</a>
		</li>
	
		<li class="social__item">
			<a class="social__link" href="https://twitter.com/bengie">
				<span class="fa fa-twitter"></span>
			</a>
		</li>
	
	
	
		<li class="social__item">
			<a class="social__link" href="https://instagram.com/bengie">
				<span class="fa fa-instagram"></span>
			</a>
		</li>
	
	
		<li class="social__item">
			<a class="social__link" href="mailto:greg@diezjietal.be">
				<span class="fa fa-envelope"></span>
			</a>
		</li>
	
	
	
	
		<li class="social__item">
			<a class="social__link" href="https://www.linkedin.com/in/diezjietal">
				<span class="fa fa-linkedin"></span>
			</a>
		</li>
	

	
	
	
</ul>

		
	</div>
</footer>


	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-7640477-2', 'auto');
	ga('send', 'pageview');

	</script>


</body>
</html>
